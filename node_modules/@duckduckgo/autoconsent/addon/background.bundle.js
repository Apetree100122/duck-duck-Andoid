!function(){"use strict";const e={enabled:!0,autoAction:"optOut",disabledCmps:[],enablePrehide:!0,detectRetries:20};function t(e,t){let s="",o="icons/cookie-idle.png";"success"===t?(s="Opt out successful!",o="icons/party.png"):"complete"===t?(s="Opt out complete!",o="icons/tick.png"):"working"===t?(s="Processing...",o="icons/cog.png"):"verified"===t?(s="Verified",o="icons/verified.png"):"idle"===t?(s="Idle",o="icons/cookie-idle.png"):"available"===t&&(s="Click to opt out",o="icons/cookie.png"),chrome.action.setTitle({tabId:e,title:s}),chrome.action.setIcon({tabId:e,path:o})}chrome.runtime.onInstalled.addListener((()=>{(async function(){const e=await fetch("./rules.json");return await e.json()})().then((e=>{chrome.storage.local.set({rules:e})}))})),chrome.runtime.onMessage.addListener((async(s,o)=>{const a=o.tab.id,c=o.frameId,r=(await chrome.storage.local.get("rules")).rules;switch(s.type){case"init":0===c&&t(a,"idle"),chrome.tabs.sendMessage(a,{type:"initResp",rules:r,config:e},{frameId:c});break;case"eval":chrome.scripting.executeScript({target:{tabId:a,frameIds:[c]},world:"MAIN",args:[s.code],func:e=>{try{return window.eval(e)}catch(e){return}}}).then((([e])=>{chrome.tabs.sendMessage(a,{id:s.id,type:"evalResp",result:e.result},{frameId:c})}));break;case"popupFound":t(a,"available"),chrome.storage.local.set({[`detected${a}`]:c});break;case"optOutResult":case"optInResult":s.result&&(t(a,"working"),s.scheduleSelfTest&&await chrome.storage.local.set({[`selfTest${a}`]:c}));break;case"selfTestResult":s.result&&t(a,"verified");break;case"autoconsentDone":{t(a,"success");const e=`selfTest${a}`,s=(await chrome.storage.local.get(e))?.[e];"number"==typeof s&&(chrome.storage.local.remove(e),chrome.tabs.sendMessage(a,{type:"selfTest"},{frameId:s}));break}case"autoconsentError":console.error("Error:",s.details)}})),chrome.action.onClicked.addListener((async e=>{const s=e.id,o=`detected${s}`,a=(await chrome.storage.local.get(o))?.[o];"number"==typeof a&&(chrome.storage.local.remove(o),t(s,"working"),chrome.tabs.sendMessage(s,{type:"optOut"},{frameId:a}))}))}();
